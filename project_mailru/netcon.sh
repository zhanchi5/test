 #!/bin/bash
#--------------------------------------------------------------------------------------------------
# Test filename var
#--------------------------------------------------------------------------------------------------
if [ -z $1 ]
then
	BASEDIR=`dirname $0`
	DIRPATH=`cd $BASEDIR; pwd`
    f=$DIRPATH/data/print_netcon
else
    f="$1"
fi
#--------------------------------------------------------------------------------------------------
buffer1=$(printf "<table border=\"1\">\n";
ss -tua | grep -v -E '(u_str)' | sed -e 's/Local /Local_/g' | sed 's/Peer /Peer_/g' | awk         \
'{ split($0, k);
   print "<tr>";
   { for (i = 1; i <= 6; i++) print "<td>"k[i]"</td>"; }
   print "</tr>"; }';
printf "\n</table>\n<br>";)
#--------------------------------------------------------------------------------------------------
buffer2=$(printf "<table border=\"1\">\n<tr><td colspan=\"2\">Total sum</td></tr>";
ss -ta | cut -d " " -f1 | tail -n +2 | sort | uniq -c | sort -r | awk -F " " \
'{ print "<tr><td>"$1"</td><td>"$2"</td></tr>" }';
printf "\n</table>\n";)
#--------------------------------------------------------------------------------------------------
echo "$buffer1 $buffer2" > $f
#--------------------------------------------------------------------------------------------------